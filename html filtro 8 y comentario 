Option Explicit

Sub Comparar_Col1_Col2_SinCabeceras()
    Dim sh As Worksheet
    Dim ultFila1 As Long, ultFila2 As Long, ultFila As Long
    Dim i As Long
    Dim dictCol1 As Object, dictCol2 As Object
    Dim clave As Variant
    Dim filaSolo1 As Long, filaSolo2 As Long, filaAmbas As Long
    
    Set sh = ActiveSheet
    
    ' Última fila usada en cada columna
    ultFila1 = sh.Cells(sh.Rows.Count, "A").End(xlUp).Row
    ultFila2 = sh.Cells(sh.Rows.Count, "B").End(xlUp).Row
    ultFila = Application.WorksheetFunction.Max(ultFila1, ultFila2)
    
    ' Diccionarios
    Set dictCol1 = CreateObject("Scripting.Dictionary")
    Set dictCol2 = CreateObject("Scripting.Dictionary")
    
    ' Rellenar diccionario Columna 1 (A)
    For i = 1 To ultFila1
        If Trim(sh.Cells(i, "A").Value) <> "" Then
            If Not dictCol1.Exists(Trim(sh.Cells(i, "A").Value)) Then
                dictCol1.Add Trim(sh.Cells(i, "A").Value), True
            End If
        End If
    Next i
    
    ' Rellenar diccionario Columna 2 (B)
    For i = 1 To ultFila2
        If Trim(sh.Cells(i, "B").Value) <> "" Then
            If Not dictCol2.Exists(Trim(sh.Cells(i, "B").Value)) Then
                dictCol2.Add Trim(sh.Cells(i, "B").Value), True
            End If
        End If
    Next i
    
    ' Limpiar columnas de resultados C, D, E
    sh.Range("C:E").ClearContents
    
    ' Filas de salida
    filaSolo1 = 1
    filaSolo2 = 1
    filaAmbas = 1
    
    ' Recorremos valores de la Columna 1
    For Each clave In dictCol1.Keys
        If dictCol2.Exists(clave) Then
            ' Está en las dos: columna 5 (E)
            sh.Cells(filaAmbas, "E").Value = clave
            filaAmbas = filaAmbas + 1
        Else
            ' Solo en columna 1: columna 3 (C)
            sh.Cells(filaSolo1, "C").Value = clave
            filaSolo1 = filaSolo1 + 1
        End If
    Next clave
    
    ' Recorremos valores de la Columna 2
    For Each clave In dictCol2.Keys
        If Not dictCol1.Exists(clave) Then
            ' Solo en columna 2: columna 4 (D)
            sh.Cells(filaSolo2, "D").Value = clave
            filaSolo2 = filaSolo2 + 1
        End If
    Next clave
    
    ' Ajustar anchos
    sh.Columns("A:E").AutoFit
    
    MsgBox "Comparación completada. Revisa columnas C (solo 1), D (solo 2) y E (ambas).", vbInformation
End Sub