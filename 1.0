Option Explicit

Dim excel, libro, hoja, fila, ultimaFila
Dim origen, destino, fs, rutaOrigen, nombreArchivo, rutaDestino
Dim copiados, fallidos

' === CONFIGURAR ===
' Pide al usuario el Excel y la carpeta de destino
Dim excelPath
excelPath = InputBox("Introduce la ruta completa del fichero Excel con las rutas:", "Seleccionar Excel")
If excelPath = "" Then WScript.Quit

destino = InputBox("Introduce la carpeta de destino donde copiar los archivos:", "Carpeta destino")
If destino = "" Then WScript.Quit

If Right(destino,1) <> "\" Then destino = destino & "\"

Set fs = CreateObject("Scripting.FileSystemObject")

If Not fs.FolderExists(destino) Then
    On Error Resume Next
    fs.CreateFolder destino
    On Error GoTo 0
End If

' === ABRIR EXCEL ===
On Error Resume Next
Set excel = GetObject(, "Excel.Application")
If Err.Number <> 0 Then
    Err.Clear
    Set excel = CreateObject("Excel.Application")
End If
On Error GoTo 0

excel.Visible = False
excel.DisplayAlerts = False

Set libro = excel.Workbooks.Open(excelPath, False, True)
Set hoja = libro.Sheets(1)

' === DETERMINAR ULTIMA FILA ===
ultimaFila = hoja.Cells(hoja.Rows.Count, 1).End(-4162).Row  ' xlUp = -4162

copiados = 0
fallidos = 0

' === RECORRER RUTAS ===
For fila = 1 To ultimaFila
    rutaOrigen = Trim(hoja.Cells(fila, 1).Value)

    If rutaOrigen <> "" Then
        If fs.FileExists(rutaOrigen) Then
            nombreArchivo = fs.GetFileName(rutaOrigen)
            rutaDestino = destino & nombreArchivo
            On Error Resume Next
            fs.CopyFile rutaOrigen, rutaDestino, True
            If Err.Number = 0 Then
                copiados = copiados + 1
            Else
                fallidos = fallidos + 1
                Err.Clear
            End If
            On Error GoTo 0
        Else
            fallidos = fallidos + 1
        End If
    End If
Next

libro.Close False
excel.Quit

Set hoja = Nothing
Set libro = Nothing
Set excel = Nothing

MsgBox "Proceso completado." & vbCrLf & _
       "Copiados correctamente: " & copiados & vbCrLf & _
       "No encontrados o con error: " & fallidos, vbInformation, "Resumen"