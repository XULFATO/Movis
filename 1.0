Sub Extractor_Panoramico_Final()
    Dim vbc As Object, codLimpio As String, lin As String, i As Long
    Dim r As Long, tamBloque As Integer: tamBloque = 100 ' Bloques más largos
    
    ' 1. MINIFICACIÓN (Corregida)
    For Each vbc In ThisWorkbook.VBProject.VBComponents
        codLimpio = codLimpio & "[[MOD:" & vbc.Name & "]]"
        On Error Resume Next
        With vbc.CodeModule
            If .CountOfLines > 0 Then
                For i = 1 To .CountOfLines
                    lin = Trim(.Lines(i, 1))
                    If lin <> "" And Left(lin, 1) <> "'" Then
                        Do While InStr(lin, "  ") > 0: lin = Replace(lin, "  ", " "): Loop
                        codLimpio = codLimpio & lin & "¶"
                    End If
                Next i
            End If
        End With
        On Error GoTo 0
    Next vbc

    ' 2. REPARTO EN 2 COLUMNAS ANCHAS (A-B y D-E)
    ' Usamos solo 2 para que el texto sea muy largo y el OCR no se pierda
    Dim ws As Worksheet: Set ws = Sheets.Add: ws.Name = "FOTO_VBA"
    Dim totalBloques As Long: totalBloques = Application.WorksheetFunction.RoundUp(Len(codLimpio) / tamBloque, 0)
    Dim bloquesPorCol As Long: bloquesPorCol = Application.WorksheetFunction.RoundUp(totalBloques / 2, 0)
    
    Dim n As Long: n = 1
    For i = 1 To Len(codLimpio) Step tamBloque
        Dim colBase As Integer: colBase = IIf(n <= bloquesPorCol, 0, 3)
        r = ((n - 1) Mod bloquesPorCol) + 2
        ws.Cells(r, colBase + 1).Value = n ' ID
        ws.Cells(r, colBase + 2).Value = "'" & Mid(codLimpio, i, tamBloque) ' DATA
        n = n + 1
    Next i
    
    ' 3. FORMATO VISUAL GIGANTE
    With ws.Range("A:E")
        .Font.Name = "Consolas": .Font.Size = 11
        .VerticalAlignment = xlTop
    End With
    ws.Columns("B").ColumnWidth = 80: ws.Columns("E").ColumnWidth = 80
    ws.Columns("C").ColumnWidth = 4
    
    Application.DisplayFullScreen = True
    MsgBox "Toma fotos que cubran las dos columnas." & vbCrLf & "Bloques totales: " & (n - 1)
End Sub

